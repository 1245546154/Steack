章文嵩博士
LVS：（linux虚拟化服务器） 3种工作方式8种调度算法

LVS集群架构的优点：
1.性能：通过一组服务器分而治之，可以获得很高的整体性能。
2.性能/价格比：价格低，具有最高的性能/价格比
3.可伸缩性：集群系统中的结点数目可以增长到几千个，其伸缩性远超过单台超级计算机（但注意负载均衡器的压力大量的节点就需要使用到路由器/三层交换的OSPF技术）
4.高可用性：在硬件和软件上都有冗余，通过检测软硬件的故障，将故障屏蔽，由存活结点提供服务，可实现高可用性。
5.管理性：方便和易维护的管理性。


在设计时需要考虑系统的透明性、可伸缩性、高可用性和易管理性。

集群采用三层结构：
服务器池：所有真实的服务器机群划分为一个整体。
负载调度器：提供给用户进行访问的虚拟IP地址，原理与VRRP一样
共享存储：它为服务器池提供一个共享的存储区，所有服务器拥有相同的内容，可以相同的服务。


当整个系统受到的负载超过目前所有结点的处理能力时，可以在服务器池中增加服务器来满足不断增长的请求负载。

缺点：
1.功能比较简单，支持复杂应用的负载均衡能力较差，如算法较少等；
2.开启隧道方式需重编译内核；
3.配置复杂；
4.无法适用与windows平台
5.扩展性有限


LVS+keepalived的基础之上升级的架构为LVS+OSPF（把linux插入到OSPF的路由表里去）

ECMP（等价多路径）：而等值多路径路由协议可以在该网络环境下同时使用多条链路

WCMP（加权多路径）：能够非常灵活地按照比例在链路上传递流量。



――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――
LVS 负载均衡：
IPVS：IP负载均衡中包括以下三种技术
VS/NAT：通过网络地址转换，将一组服务器构成一个高性能的虚拟服务器
VS/TUN：通过IP隧道实现虚拟服务器
VS/DR：通过直接路由实现虚拟服务器



1. NAT模式（类似路由器，实现外网内网地址映射，负载均衡服务器修改请求包的源以及目的MAC地址和IP地址，发送给实际服务器；负载均衡服务器，修改响应包的源以及目的MAC地址和IP地址，发送给客户端。请求和响应报文都需要经过负载均衡服务器） 

2. TUN模式（IP隧道，负载均衡服务器将外网传来的数据包封装在IP隧道中，传给实际服务器。实际服务器的响应直接发给客户端，而不需要经过负载均衡服务器。） 

3. DR模式（负载均衡服务器和后端的实际服务器拥有相同的虚拟IP地址，负载均衡服务器收到响应包后，修改目的MAC地址发给实际服务器，实际服务器将响应包直接发给客户端，不需要经过负载均衡服务器）


――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――――

yum -y install ipvsadm 

systemctl start ipvsadm
ipvsadm -C
ipvsadm --set 30 5 60
#vip on load balancer
ipvsadm -A -t 10.10.10.22:80 -s wrr -p 20 #接受转发协议
ipvsadm -a -t 10.10.10.22:80 -r 10.10.10.31:80 -g -w 1 #增加转发目的地
ipvsadm -a -t 10.10.10.22:80 -r 10.10.10.32:80 -g -w 1 #增加转发目的地
ipvsadm -L -n














